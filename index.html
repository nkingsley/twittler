<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="jquery.timeago.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <style>
  #homeStreamHolder{
    padding:1%;
    float:left;
    width:47%;
    border:1px solid;
    border-radius:20px;
  }
  #sidebarHolder{
    padding:1%;
    float:right;
    background:blue;
    width:47%;
    border:1px solid;
    border-radius:20px;
    display:none;
  }
  </style>
  <body>
    <div id = "sidebarHolder"></div>
    <div id = "homeStreamHolder">ALL TWITTLES:<div id = "homeStreams"></div></div>
    <script>
      var resetUserInterval = '';
      var scope = streams.home;
      var currTweet = 0;
      var currUserTweet = 0;
      $(document).ready(function(){
        currTweet = tweetUpdate(scope,0,'#homeStreams');
        setInterval(function(){
          currTweet = tweetUpdate(scope,currTweet,'#homeStreams');
        }, 3000);
        $(document).on('click', '.userLink', function(){
          var user = this.text.slice(1);
          $('#sidebarHolder').html(user + "'s Twittles: <div id = 'sidebar'></div>");
          user = streams.users[user];
          clearInterval(resetUserInterval);
          currUserTweet = tweetUpdate(user,0,'#sidebar');
          resetUserInterval = setInterval(function(){
          currUserTweet = tweetUpdate(user,currUserTweet,'#sidebar');
        }, 3000);
          $('#sidebarHolder').fadeIn('fast');
          return false;
      });
      });
    function showTweet(index,scope,layout){
      var tweet = scope[index];
      var $tweet = $('<div></div>');
      $tweet.html('<abbr class="timeago" title="' + tweet.created_at.toISOString() + '">' + tweet.created_at + '</abbr><a class = "userLink" href = "#">@' + tweet.user + '</a>: ' + tweet.message);
      $tweet.prependTo($(layout));
      jQuery("abbr.timeago").timeago();
    }
    function tweetUpdate(scope,currTweet,layout){
      var toAdd = (scope.length - 1) - currTweet;
      for (var i=1 ; i < toAdd ; i++){
        showTweet(currTweet + i, scope,layout);
      }
      return currTweet + i;
    }
    </script>
  </body>
</html>
